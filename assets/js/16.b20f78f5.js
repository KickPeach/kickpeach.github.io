(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{217:function(t,e,a){"use strict";a.r(e);var s=a(2),n=Object(s.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"数据库操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库操作","aria-hidden":"true"}},[t._v("#")]),t._v(" 数据库操作")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("在控制器通过db获得数据库实例，使用ORM会给带来一些性能的损耗，所以使用编写SQL+使用PDO进行数据库的操作是最好的了，只需编写原生SQL.")]),t._v(" "),a("p",[t._v("增删查改的具体方法：")]),t._v(" "),a("ul",[a("li",[t._v("在控制器中使用")])]),t._v(" "),a("p",[t._v("继承父类Controller后，我们可以使用")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("db")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("在model分层中使用")])]),t._v(" "),a("p",[t._v("在app/models中编写你的model，继承父类Models，我们就可以使用")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("db")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("具体可以见app/Models/User文件")]),t._v(" "),a("p",[t._v("上述两种方法可以获取到数据库连接对象")]),t._v(" "),a("ul",[a("li",[t._v("插入数据以及获取插入的ID")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$insertId = $this->>db()->table('profile')->insertGetId([\n    'name'      => 'test-name',\n    'gender'    => 1,\n    'birthday'  => '1988-12-01 01:00:01', //DATETIME\n    'memo'      => 'this is a test memo',\n    'lat'       => '30.54916000', //DECIMAL(10,8)\n    'lng'       => '104.06761000' //DECIMAL(11,8)\n]);\n")])])]),a("ul",[a("li",[t._v("插入数据以及获取影响的行数")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$affectNum =  $this->>db()->table('profile')->insert([\n    [\n        'name'      => 'test-name',\n        'gender'    => 1,\n        'birthday'  => '1988-12-01 01:00:01',\n        'memo'      => 'this is a test memo',\n        'lat'       => '30.54916000',\n        'lng'       => '104.06761000'\n    ],\n    [\n        'name'      => 'test-name-1',\n        'gender'    => 1,\n        'birthday'  => '2010-12-01 01:00:01',\n        'memo'      => 'this is another test memo',\n        'lat'       => '30.54916000',\n        'lng'       => '104.06761000'\n    ],\n]);\n")])])]),a("ul",[a("li",[t._v("更新数据并获得影响的行数")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("affectNum = $this->>db()->update('update profile set name = :name, memo = :memo where id = :id', [\n    ':name'     => 'test-name',\n    ':memo'     => 'this is another memo',\n    ':id'       => $id,\n]);\n")])])]),a("ul",[a("li",[t._v("查询")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$records = $this->>db()->select('select * from profile where id = :id', [\n    ':id'   => $id,\n]);\n")])])]),a("ul",[a("li",[t._v("删除并获得影响的行数")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$affectNum = $this->>db()->delete('delete from profile where id = :id', [\n    ':id'       => $id,\n]);\n")])])]),a("ul",[a("li",[t._v("事务")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$conn->transaction(function ($conn) {\n    //do something...\n});\n")])])]),a("ul",[a("li",[t._v("获取查询日志")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$queryLogs = $this->>db()->getQueryLog();\n")])])])])},[],!1,null,null,null);e.default=n.exports}}]);