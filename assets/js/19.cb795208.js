(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{215:function(e,t,a){"use strict";a.r(t);var s=a(2),r=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#database","aria-hidden":"true"}},[e._v("#")]),e._v(" database")]),e._v(" "),a("p",[e._v("基于PDO的kickpeach框架的databbase组件，亦可以独立使用，支持MySQl以及PostgreSQL数据库")]),e._v(" "),a("h1",{attrs:{id:"怎么使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么使用","aria-hidden":"true"}},[e._v("#")]),e._v(" 怎么使用")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%AE%89%E8%A3%85"}},[e._v("安装")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8"}},[e._v("使用")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#get-connection"}},[e._v("get connection")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#insert-and-get-insert-id"}},[e._v("insert and get insert id")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#insert-and-get-the-number-of-rows-affected"}},[e._v("insert and get the number of rows affected")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#update-and-get-the-number-of-rows-affected"}},[e._v("update and get the number of rows affected")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#select"}},[e._v("select")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#delete-and-get-the-number-of-rows-affected"}},[e._v("delete and get the number of rows affected")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#transaction"}},[e._v("transaction")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#get-query-logs"}},[e._v("get query logs")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#execute-the-given-callback-in-dry-run%E7%A9%BA%E8%BD%AC-mode"}},[e._v('execute the given callback in "dry run"(空转) mode')])])])]),e._v(" "),a("li",[a("a",{attrs:{href:"#license"}},[e._v("License")])])]),e._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),a("div",{staticClass:"language-cmd extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("    composer require kickpeach/database -vvv\n")])])]),a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),a("p",[e._v("具体使用，可参考"),a("a",{attrs:{href:"https://github.com/KickPeach/database/blob/master/tests/DatabaseTest.php",target:"_blank",rel:"noopener noreferrer"}},[e._v("tests"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"get-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#get-connection","aria-hidden":"true"}},[e._v("#")]),e._v(" get connection")]),e._v(" "),a("ul",[a("li",[e._v("MySql")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$dsn = sprintf('mysql:host=%s;port=%s;dbname=%s;charset=%s', '127.0.0.1', 3306, 'es_demo', 'utf8mb4');\n$conn = new MySqlConnection($dsn, 'root', 123123);\n")])])]),a("ul",[a("li",[e._v("Postgres")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$dsn = sprintf('pgsql:host=%s;port=%s;dbname=%s', '127.0.0.1', 3306, 'es_demo');\n$conn = new PostgresConnection($dsn, 'root', 123123);\n")])])]),a("h3",{attrs:{id:"insert-and-get-insert-id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#insert-and-get-insert-id","aria-hidden":"true"}},[e._v("#")]),e._v(" insert and get insert id")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$insertId = $conn->table('profile')->insertGetId([\n    'name'      => 'test-name',\n    'gender'    => 1,\n    'birthday'  => '1988-12-01 01:00:01', //DATETIME\n    'memo'      => 'this is a test memo',\n    'lat'       => '30.54916000', //DECIMAL(10,8)\n    'lng'       => '104.06761000' //DECIMAL(11,8)\n]);\n")])])]),a("h3",{attrs:{id:"insert-and-get-the-number-of-rows-affected"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#insert-and-get-the-number-of-rows-affected","aria-hidden":"true"}},[e._v("#")]),e._v(" insert and get the number of rows affected")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$affectNum = $conn->table('profile')->insert([\n    [\n        'name'      => 'test-name',\n        'gender'    => 1,\n        'birthday'  => '1988-12-01 01:00:01',\n        'memo'      => 'this is a test memo',\n        'lat'       => '30.54916000',\n        'lng'       => '104.06761000'\n    ],\n    [\n        'name'      => 'test-name-1',\n        'gender'    => 1,\n        'birthday'  => '2010-12-01 01:00:01',\n        'memo'      => 'this is another test memo',\n        'lat'       => '30.54916000',\n        'lng'       => '104.06761000'\n    ],\n]);\n")])])]),a("h3",{attrs:{id:"update-and-get-the-number-of-rows-affected"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update-and-get-the-number-of-rows-affected","aria-hidden":"true"}},[e._v("#")]),e._v(" update and get the number of rows affected")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("affectNum = $conn->update('update profile set name = :name, memo = :memo where id = :id', [\n    ':name'     => 'test-name',\n    ':memo'     => 'this is another memo',\n    ':id'       => $id,\n]);\n")])])]),a("h3",{attrs:{id:"select"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#select","aria-hidden":"true"}},[e._v("#")]),e._v(" select")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$records = $conn->select('select * from profile where id = :id', [\n    ':id'   => $id,\n]);\n")])])]),a("h3",{attrs:{id:"delete-and-get-the-number-of-rows-affected"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#delete-and-get-the-number-of-rows-affected","aria-hidden":"true"}},[e._v("#")]),e._v(" delete and get the number of rows affected")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$affectNum = $conn->delete('delete from profile where id = :id', [\n    ':id'       => $id,\n]);\n")])])]),a("h3",{attrs:{id:"transaction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#transaction","aria-hidden":"true"}},[e._v("#")]),e._v(" transaction")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$conn->transaction(function ($conn) {\n    //do something...\n});\n")])])]),a("h3",{attrs:{id:"get-query-logs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#get-query-logs","aria-hidden":"true"}},[e._v("#")]),e._v(" get query logs")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$queryLogs = $conn->getQueryLog();\n")])])]),a("h3",{attrs:{id:"execute-the-given-callback-in-dry-run-空转-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#execute-the-given-callback-in-dry-run-空转-mode","aria-hidden":"true"}},[e._v("#")]),e._v(' execute the given callback in "dry run"(空转) mode')]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$conn->pretend(function ($conn) {\n    //do something...\n});\n")])])]),a("h2",{attrs:{id:"license"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#license","aria-hidden":"true"}},[e._v("#")]),e._v(" License")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://opensource.org/licenses/MIT",target:"_blank",rel:"noopener noreferrer"}},[e._v("MIT"),a("OutboundLink")],1)])])},[],!1,null,null,null);t.default=r.exports}}]);