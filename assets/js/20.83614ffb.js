(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{212:function(s,a,t){"use strict";t.r(a);var e=t(2),n=Object(e.a)({},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mdcalls"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mdcalls","aria-hidden":"true"}},[s._v("#")]),s._v(" mdCalls")]),s._v(" "),t("p",[s._v("mdCalls，module calls的简写，是一个解决依赖以及单例调用的模块化服务的package,支持rpc调用以及任意使用composer的框架使用，帮助模块化组织各种服务逻辑，让服务间调用方式更加同意")]),s._v(" "),t("h2",{attrs:{id:"平常使用调用其他服务的方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#平常使用调用其他服务的方式","aria-hidden":"true"}},[s._v("#")]),s._v(" 平常使用调用其他服务的方式")]),s._v(" "),t("ul",[t("li",[s._v("new 创建")])]),s._v(" "),t("p",[s._v("new UserService(),导致同个类被实例化多次，占用内存")]),s._v(" "),t("ul",[t("li",[s._v("依赖注入")])]),s._v(" "),t("p",[s._v("虽说有容器可以解决依赖问题，但是在一些不支持容器的框架中也只能使用new 方式来创建。")]),s._v(" "),t("h2",{attrs:{id:"mdcalls模块化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mdcalls模块化","aria-hidden":"true"}},[s._v("#")]),s._v(" mdcalls模块化")]),s._v(" "),t("p",[s._v("mdcalls提供了一种新的选择，每个模块都会实例化一次，每个模块的服务提供唯一的入口暴露给调用方，每个模块之间可以划分各种子模块，模块可以调用子模块的来完成业务逻辑。")]),s._v(" "),t("p",[s._v("例如:")]),s._v(" "),t("div",{staticClass:"language-cmd extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("    $ret = $this->mdc->User->setInfo('seven',24);\n")])])]),t("h1",{attrs:{id:"使用方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用方法","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用方法")]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-cmd extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\ncomposer require kickpeach/mdcalls -vvv\n\n")])])]),t("h2",{attrs:{id:"mdcalls源码解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mdcalls源码解析","aria-hidden":"true"}},[s._v("#")]),s._v(" mdCalls源码解析")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("src根文件夹\n├── MdCallsService.php\t\tMdCallsService服务类\n├── Basic/\t\t\t\t\t\n│   └── MdCallsBasic.php\tMdCalls基类\n└── Exceptions/\t\t\t\t\n    └── MdCallsException.php MdCalls异常类\n    \n")])])]),t("p",[s._v("代码是不是很简单呢，只有三个文件，看懂了这三个文件，也差不多就可以很好的使用模块化了")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/KickPeach/mdCalls/blob/master/src/MdCallsService.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("MdCallsService"),t("OutboundLink")],1),s._v("\n提供单例入口并且自动加载模块并调用，并返回模块实例对象")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/KickPeach/mdCalls/blob/master/src/Basic/MdCallsBasic.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("MdCallsBasic"),t("OutboundLink")],1),s._v("\n加载服务子类")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/KickPeach/mdCalls/blob/fee1ca39eb7b548b7b7430c82ee4d52e739b34a5/src/Exceptions/MdCallsException.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("MdCallsException"),t("OutboundLink")],1),s._v("\n简单抛出异常")]),s._v(" "),t("h2",{attrs:{id:"编写模块化服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写模块化服务","aria-hidden":"true"}},[s._v("#")]),s._v(" 编写模块化服务")]),s._v(" "),t("ul",[t("li",[s._v("参考例子")])]),s._v(" "),t("p",[s._v("请见"),t("a",{attrs:{href:"https://github.com/KickPeach/mdCalls/tree/master/tests/mdcalls",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),t("OutboundLink")],1)]),s._v(" "),t("ul",[t("li",[s._v("目录结构")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mdcalls 根文件夹\n├── MdCalls.php\t\t\t\t入口类\n├── Basic/\t\t\t\t\t文件夹\n│   └── MdCallsBasic.php\t\t\t\t服务基类\n└── Service/\t\t\t\tService文件夹，包括所有的服务模块\n    └── User/\t\t\t    服务模块1：User模块\n        └── UserIndex.php\t服务模块入口\n        ├── Child/\t\t\t模块子类文件夹\n        │   └── UserInfo.php\t模块子类\t\n    └── Message/\t\t\t服务模块2：Message模块\n        ├── Child/\n        │   └── MessageList.php\n        └── MessageIndex.php\t\t\n")])])]),t("ul",[t("li",[s._v("入口类"),t("code",[s._v("php MdCalls.php")])])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("Tests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("kickPeach"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("mdCalls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("kickPeach"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("mdCalls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("MdCallsService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MdCalls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MdCallsService")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mdCallsInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mdCallsNamespace")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'Tests\\kickPeach\\mdCalls'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])])]),t("p",[s._v("需要定义好$mdCallsNamespace，这样子，在调用子类或者mdcalls的找得到文件，这个是重中之中的事情，同事也需要，定义好$mdCallsInstance。")]),s._v(" "),t("ul",[t("li",[s._v("mdCalls基类"),t("code",[s._v("php Basic/MdCallsBasic.php")])])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("Tests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("kickPeach"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("mdCalls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Basic")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[s._v("kickPeach"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("mdCalls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Basic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("MdCallsBasic")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" Basic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MdCallsBasic")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Basic")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeRpc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$method")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$args")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sprintf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'rpc host:%s,modulename:%s,method:%s,args:%s'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("rpc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'host'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getModuleName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$method")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("var_export")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$args")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])])]),t("p",[s._v("这里需要使用rpc，那么需要实现invokeRpc方法，这个类为其他模块的父类，所有模块都需要继承此类。")]),s._v(" "),t("ul",[t("li",[s._v("Service类的创建")])]),s._v(" "),t("p",[s._v("首先，各个模块的服务都需要放在Service文件夹下，这里的服务指的是，可以单独完成某个功能的类，比如在我们的测试案例中，我们可以拆分成User,Passage,Goods等服务，")]),s._v(" "),t("p",[s._v("其次，每个服务的入口类在这里需要以 “服务名+Index”这样命名，比如在User服务中，入口类为"),t("code",[s._v("UserIndex.php")]),s._v(",在入口类，我们暴露一下对外访问的方法，只接受参数和返回数据，处理业务逻辑，不做具体业务功能的实现")]),s._v(" "),t("p",[s._v("具体的业务实现都在Child中，比如User服务中，我们需要获取用户信息"),t("code",[s._v("UserInfo")]),s._v("等等功能，我们可以在Child文件下，区分大小写，新建UserInfo类继承Basic/MdCallsBasic,这样子，我们在UserIndex可以通过\n调用loadC获取到具体业务逻辑的实例，如下：")]),s._v(" "),t("div",{staticClass:"language-cmd extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("        $this->user = $this->loadC('UserInfo','getInfo');\n")])])]),t("p",[s._v("如果需要新建新的服务，同上的User做法，新建服务名文件夹，定义好以服务名+Index的入口类，然后再Child文件夹下，定义好各种实现具体业务逻辑的类，服务入口类还有业务逻辑的类都需要继承自"),t("code",[s._v("Basic/MdCallsBasic")]),s._v('\n在入口调用子类的方法为loadC("子模块名"，"参数")')]),s._v(" "),t("h2",{attrs:{id:"调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用","aria-hidden":"true"}},[s._v("#")]),s._v(" 调用")]),s._v(" "),t("ul",[t("li",[s._v("在Service模块服务内调用")])]),s._v(" "),t("p",[s._v("$this->mdc->模块->方法()")]),s._v(" "),t("ul",[t("li",[s._v("在Service模块服务外调用")])]),s._v(" "),t("p",[s._v("先实例化mdc服务，参考"),t("a",{attrs:{href:"https://github.com/KickPeach/mdCalls/blob/fee1ca39eb7b548b7b7430c82ee4d52e739b34a5/tests/MdCallTest.php",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("       "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("mdc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MdCalls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mdc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("模块"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("方法"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h2",{attrs:{id:"使用rpc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用rpc","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用rpc")]),s._v(" "),t("p",[s._v("需要在入口类中配置属性$rpc")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * rpc配置\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rpc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'host'")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//网关地址")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'method'")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//方法名 减少无用的远程调用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("以及实现你所需要的调用方法")]),s._v(" "),t("h1",{attrs:{id:"license"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#license","aria-hidden":"true"}},[s._v("#")]),s._v(" License")]),s._v(" "),t("p",[s._v("The MIT License (MIT).")])])},[],!1,null,null,null);a.default=n.exports}}]);